import json
import requests
from pandas import *
  
# reading CSV file
data = read_csv("dynamic_api_call_sequence_per_malware_100_0_306.csv")
#converting column "hash" into list
ids = data['hash'].tolist()

#gettings hash values from ids list
#ids[0:100] indicates file no 2 to 102 from csv file
for id in ids[5906:5908] :
    
    url = 'https://www.virustotal.com/api/v3/files/'+ id
    apikey = 'b13bd14ae6e55937bdb1c147cbac84837569d1044da76a8bfd58967d2799fac6'
    #store api calls from malicious files in malicious.txt
    f = open('malicious.txt', 'a')
    #store api calls from benign files in benign.txt
    f1 = open('benign.txt', 'a')

    headers = {
     'x-apikey': apikey ,
     'Content-Type': 'application/json; charset=utf-8'
     }
    
    r = requests.get(url, headers=headers)
    
    files = r.json()
    
    #variable indicating how many vendors flagged this file as malicious
    malicious = files['data']['attributes']['last_analysis_stats']['malicious']
    
    #uncomment below code if u want to include id also in output file
    
#     if(malicious > 0):
#         f.write(id+"\n")
#     else:
#         f1.write(id+"\n")
    
    for file in files['data']['attributes']['pe_info']['import_list']:
        
        #for malicious file
        if(malicious > 0 ) :
            f.write("[")
            for item in file['imported_functions']:
                f.write(item+",")
            f.write("]\n")
            
        #for benign file
        else:
            f1.write("[")
            for item in file['imported_functions']:
                f1.write(item+",")
            f1.write("]\n")
            
f1.close()
f.close()


# In[ ]:




