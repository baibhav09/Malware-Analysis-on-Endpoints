#!/bin/bash

# Update the master and install Ansible
echo "Updating the master and installing Ansible..."
sudo apt-get update
sudo apt-get install -y ansible

# Define target machine name and IP
TARGET_NAME="baibhav"
TARGET_IP="192.168.1.126"

# Update and install Python on the target machine
echo "Updating the target machine and installing Python..."
ssh root@$TARGET_IP 'apt-get update && apt-get install -y python3'

# Configure SSH access
echo "Configuring SSH access..."
ssh-keygen -t rsa -N "" -f ~/.ssh/id_rsa
ssh-copy-id root@$TARGET_IP

# Test SSH connection
ssh root@$TARGET_IP "echo 'SSH connection established.'"

# Set up Ansible Host
echo "Setting up Ansible Host..."
echo -e "[$TARGET_NAME]\n$TARGET_NAME ansible_ssh_host=$TARGET_IP" | sudo tee -a /etc/ansible/hosts

# Test Ansible connection
echo "Testing Ansible connection..."
ansible -m ping $TARGET_NAME

# Create Ansible playbook to install a package
echo "Creating Ansible playbook to install a package..."
cat <<EOL > install_package.yml
---
- name: Install a package on the target machine
  hosts: $TARGET_NAME
  become: yes
  tasks:
    - name: Install htop
      apt:
        name: htop
        state: present
EOL

# Run the Ansible playbook
echo "Running the Ansible playbook..."
ansible-playbook install_package.yml

echo "Setup complete."
